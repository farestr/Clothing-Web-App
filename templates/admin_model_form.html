{% extends "base.html" %}
{% block title %}Admin · {{ "Edit" if model else "New" }} Model{% endblock %}

{% block content %}
<div class="page-head page-head--split">
  <div>
    <h1>Admin · {{ "Edit" if model else "New" }} model</h1>
    <div class="muted">Add product details and upload an image.</div>
  </div>
  <a class="btn btn--ghost" href="{{ url_for('admin_models') }}">← Back</a>
</div>

<section class="panel" style="max-width:820px;">
  <h2 class="panel__title">{{ "Edit" if model else "Create" }} model</h2>

  <form method="post" enctype="multipart/form-data" class="form form--grid">

    <div>
      <label class="label">Name</label>
      <input class="input" name="Name" value="{{ model.Name if model else '' }}" required>
    </div>

    <div>
      <label class="label">Model Number</label>
      <input class="input" name="ModelNumber" value="{{ model.ModelNumber if model else '' }}" required>
    </div>

    <div>
      <label class="label">Gender</label>
      <select class="select" name="Gender" required>
        {% set g = model.Gender if model else "Both" %}
        <option value="Male"   {% if g=="Male" %}selected{% endif %}>Male</option>
        <option value="Female" {% if g=="Female" %}selected{% endif %}>Female</option>
        <option value="Both"   {% if g=="Both" %}selected{% endif %}>Both</option>
      </select>
    </div>

    <div class="col-span">
      <label class="label">Description</label>
      <textarea class="textarea" name="Description" rows="3"
        placeholder="Write a short description...">{{ model.Description if model else '' }}</textarea>
    </div>

    <div>
      <label class="label">Price</label>
      <input class="input" name="Price" type="number" step="0.01"
             value="{{ model.Price if model else '' }}" required>
      <div class="muted small">Cost price (what the store pays).</div>
    </div>

    <div>
      <label class="label">Sell Price</label>
      <input class="input" name="Sell_Price" type="number" step="0.01"
             value="{{ model.Sell_Price if model else '' }}" required>
      <div class="muted small">Customer selling price.</div>
    </div>
    <label for="SupplierID">Supplier</label>
<select name="SupplierID" id="SupplierID">
  <option value="">-- Select Supplier --</option>
  {% for s in suppliers %}
    <option value="{{ s.SupplierID }}" {% if model and model.SupplierID==s.SupplierID %}selected{% endif %}>
      {{ s.Name }}
    </option>
  {% endfor %}
</select>

    <div>
      <label class="label">Profit (auto)</label>
      <input class="input" type="text" value="{% if model %}{{ model.Profit }}{% else %}Auto = Sell - Price{% endif %}" disabled>
      <div class="muted small">Profit is calculated in Flask (Sell - Price).</div>
    </div>

    <div class="col-span">
      <label class="label">Image</label>
      <input class="input" name="product_image" type="file" accept="image/*">
      {% if model %}
        <div class="muted small" style="margin-top:8px;">
          Current: <b>{{ model.Item_Image }}</b>
        </div>
        <div class="thumb" style="margin-top:10px;">
          <img
            src="{{ url_for('static', filename='uploads/' + (model.Item_Image or 'default.png')) }}"
            alt="current image"
            onerror="if(!this.dataset.fallback){this.dataset.fallback=1; this.src='{{ url_for('static', filename='uploads/default.png') }}'}"
          >
        </div>
      {% else %}
        <div class="muted small" style="margin-top:8px;">If you don’t upload, it uses default.png</div>
      {% endif %}
    </div>

    <div class="col-span row" style="gap:10px;">
      <button class="btn" type="submit">{{ "Save changes" if model else "Create model" }}</button>
      <a class="btn btn--ghost" href="{{ url_for('admin_models') }}">Cancel</a>
    </div>

  </form>
</section>
{% endblock %}
